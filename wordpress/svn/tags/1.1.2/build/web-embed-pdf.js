!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,n,t,o){return new(t||(t=Promise))((function(i,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function l(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,l)}c((o=o.apply(e,n||[])).next())}))}function n(e,n){var t,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(a=0)),a;)try{if(t=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(e){l=[6,e],o=0}finally{t=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}function t(e,n,t){if(t||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return e.concat(o||Array.prototype.slice.call(n))}var o,i,r,a,l;"function"==typeof SuppressedError&&SuppressedError;var c="simplePDF_modal",s="simplePDF_modal_close_button",d="simplePDF_modal_style",u="simplePDF_iframe",f={getFromConfig:function(e){var n,t,o;return null!==(o=null===(t=null===(n=window.simplePDF)||void 0===n?void 0:n.config)||void 0===t?void 0:t[e])&&void 0!==o?o:null},log:function(e,n){var t,o=null===(t=document.currentScript)||void 0===t?void 0:t.getAttribute("debug");null!=o&&console.warn("@simplepdf/web-embed-pdf: ".concat(e),n)},autoOpenListeners:null!==(i=null===(o=window.simplePDF)||void 0===o?void 0:o._ctx.listenersMap)&&void 0!==i?i:new Map,outgoingEventsQueue:[],isIframeReady:!1,getEditor:function(){return{iframe:document.getElementById(u),modal:document.getElementById(c),styles:document.getElementById(d)}}},p={locale:function(){var e,n,t,o,i=function(){try{return new Intl.Locale(document.documentElement.lang).language}catch(e){return null}}(),r=null!==(o=null!==(t=null!==(e=f.getFromConfig("locale"))&&void 0!==e?e:null===(n=document.currentScript)||void 0===n?void 0:n.getAttribute("locale"))&&void 0!==t?t:i)&&void 0!==o?o:"en";switch(r){case"en":case"de":case"es":case"fr":case"it":case"pt":return r;default:return"en"}}(),companyIdentifier:null!==(l=null!==(r=f.getFromConfig("companyIdentifier"))&&void 0!==r?r:null===(a=document.currentScript)||void 0===a?void 0:a.getAttribute("companyIdentifier"))&&void 0!==l?l:"embed",autoOpen:!1},m=function(e){var n,t=null===(n=window.simplePDF)||void 0===n?void 0:n.config;if(!t)throw Error("Unexpected: window.simplePDF not initialized");return Object.keys(e).forEach((function(n){var o=n,i=e[o];if(void 0!==i){if(f.log("Update config",{configKey:o,configValue:i}),"autoOpen"===o)!0===i?F():P();t[o]=i}})),t},g=function(){h(),document.body.style.overflow="initial"},v=function(e){var n=f.getEditor,t=f.outgoingEventsQueue,o=f.getFromConfig,i=f.log,r=n().iframe,a="https://".concat(o("companyIdentifier"),".simplepdf.com"),l=new URL(e.origin).origin,c=new URL(a).origin;if(l===c){if(e.source===(null==r?void 0:r.contentWindow)){var s=function(){try{return JSON.parse(e.data)}catch(e){return console.error("Failed to parse iFrame event payload"),null}}();return"EDITOR_READY"===(null==s?void 0:s.type)?(f.isIframeReady=!0,t.forEach((function(e){y(e)})),void(t.length=0)):void 0}i("Incoming message from untrusted iframe",{eventOrigin:l,iframeOrigin:c})}else i("Incoming message from untrusted origin",{eventOrigin:l,iframeOrigin:c})},h=function(){var e,n;window.removeEventListener("message",v),null===(e=f.getEditor().modal)||void 0===e||e.remove(),null===(n=f.getEditor().styles)||void 0===n||n.remove(),f.isIframeReady=!1,f.outgoingEventsQueue.length=0};function y(e){var n,t,o,i,r=f.outgoingEventsQueue,a=f.log,l=f.isIframeReady,c=new URL(null!==(t=null===(n=f.getEditor().iframe)||void 0===n?void 0:n.src)&&void 0!==t?t:"");if(l)return a("Send iframe event",{event:e}),void(null===(i=null===(o=f.getEditor().iframe)||void 0===o?void 0:o.contentWindow)||void 0===i||i.postMessage(JSON.stringify(e),c.origin));a("Push event to queue",{event:e}),r.push(e)}var w,b=function(t){var o,i=t.href,r=t.context,a=f.getFromConfig,l=f.log,p=f.getEditor;if(p().iframe)l("Editor already opened",{});else{var m=a("companyIdentifier"),h=a("locale"),w=function(){if(!r)return null;try{return encodeURIComponent(btoa(JSON.stringify(r)))}catch(e){return l("Failed to encode the context: ".concat(JSON.stringify(e)),{context:r}),null}}(),b=new URL("/".concat(h,"/editor"),"https://".concat(m,".simplepdf.com"));i&&b.searchParams.set("loadingPlaceholder","true"),w&&b.searchParams.set("context",w);var x='\n    <style id="'.concat(d,'">\n      .simplePDF_container {\n        user-select: none;\n        position: fixed;\n        display: flex;\n        box-sizing: border-box;\n        align-items: center;\n        justify-content: center;\n\n        height: 100vh;\n        width: 100%;\n        z-index: 2147483647;\n        padding: 16px;\n        top: 0;\n        left: 0;\n        background: rgba(0, 0, 0, 0.4);\n      }\n\n      .simplePDF_content {\n        width: 100%;\n        height: 100%;\n        position: relative;\n        box-sizing: border-box;\n      }\n\n      .simplePDF_iframeContainer {\n        overflow: hidden;\n        background: #f1f7ff;\n        border-radius: 6px;\n        width: 100%;\n        height: 100%;\n      }\n\n      .simplePDF_iframe {\n        border: none;\n        border-radius: 6px;\n        width: 100%;\n        height: 100%;\n      }\n\n      .simplePDF_close {\n        z-index: 1;\n        position: absolute;\n        top: -12px;\n        right: -12px;\n\n        border: none;\n        padding: 6px;\n        border-radius: 50px;\n\n        display: flex;\n        align-items: center;\n        justify-content: center;\n\n        box-shadow: 0 1px 3px rgb(0 0 0 / 10%), 0 1px 2px rgb(0 0 0 / 24%);\n\n        cursor: pointer;\n        background: #ff5959;\n        text-shadow: 1px 1px #243889;\n      }\n\n      .simplePDF_close svg {\n          fill: white;\n          width: 14px;\n          height: 14px;\n      }\n\n      .simplePDF_close:hover {\n          box-shadow: 0 2px 4px rgb(0 0 0 / 10%), 0 4px 4px rgb(0 0 0 / 24%);\n      }\n  </style>\n  <div class="simplePDF_container" aria-modal="true" id="').concat(c,'">\n    <div class="simplePDF_content">\n      <button id="').concat(s,'" class="simplePDF_close" aria-label="Close PDF editor modal">\n        <svg height="512" viewBox="0 0 512 512" width="512" xml-space="preserve" xmlns="http://www.w3.org/2000/svg">\n          <path d="M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z" />\n        </svg>\n      </button>\n      <div class="simplePDF_iframeContainer">\n        <iframe id="').concat(u,'" referrerPolicy="no-referrer-when-downgrade" class="simplePDF_iframe" src="').concat(b.href,'" onload="').concat(void window.addEventListener("message",v),'"/>\n      </div>\n    </div>\n  </div>\n ');if(l("Creating the modal",{companyIdentifier:a("companyIdentifier"),iframeURL:b}),document.body.style.overflow="hidden",document.body.insertAdjacentHTML("beforebegin",x),i){e(void 0,void 0,void 0,(function(){var e,t,o;return n(this,(function(n){switch(n.label){case 0:return[4,fetch(null!=i?i:"",{method:"GET",credentials:"same-origin"})];case 1:if(!(e=n.sent()).ok)throw new Error("Failed to retrieve the document: ".concat(JSON.stringify({status:e.status,href:i})));return[4,e.blob()];case 2:return t=n.sent(),o=new FileReader,[4,new Promise((function(e,n){o.onload=e,o.onerror=n,o.readAsDataURL(t)}))];case 3:return n.sent(),[2,o.result]}}))})).then((function(e){y({type:"LOAD_DOCUMENT",data:{data_url:e,name:i.substring(i.lastIndexOf("/")+1).split("?")[0]}})})).catch((function(){var e=p().iframe;if(!e)throw Error("Unexpected: SimplePDF iframe not instantiated");b.searchParams.delete("loadingPlaceholder"),b.searchParams.set("open",i),e.src=b.href}))}l("Attach close modal listener",{}),null===(o=document.getElementById(s))||void 0===o||o.addEventListener("click",g)}},x=function(e){return e.hasAttribute("href")},E=function(){return f.autoOpenListeners.size},F=function(){var e=E();if(e>0)f.log("Listeners already attached",{listenersCount:e});else{var n=t(t([],Array.from(document.getElementsByClassName("simplepdf")).filter((function(e){return!x(e)})),!0),Array.from(document.getElementsByTagName("a")).filter((function(e){return!e.classList.contains("exclude-simplepdf")&&(e.href.includes(".pdf")||e.classList.contains("simplepdf")||(n=e.href,/^https:\/\/[^.]+\.simplepdf\.com\/[^\/]+\/form\/.+/.test(n)));var n})),!0);f.log("Attaching listeners to anchors",{anchorsCount:n.length}),n.forEach((function(e){var n=function(n){n.preventDefault(),b({href:x(e)?e.href:null})};e.addEventListener("click",n),f.autoOpenListeners.set(e,n)}))}},P=function(){var e=E();0!==e?(f.log("Removing listeners",{listenersCount:e}),f.autoOpenListeners.forEach((function(e,n){n.removeEventListener("click",e)})),f.autoOpenListeners.clear()):f.log("No listeners to remove",{})};window.simplePDF=null!==(w=window.simplePDF)&&void 0!==w?w:{config:p,setConfig:m,openEditor:b,closeEditor:g,_ctx:{listenersMap:new Map}},"undefined"!=typeof document&&document.currentScript&&m({autoOpen:!0})}));
